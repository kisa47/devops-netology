# Домашнее задание к занятию "6.1. Типы и структура СУБД"

## Введение

Перед выполнением задания вы можете ознакомиться с 
[дополнительными материалами](https://github.com/netology-code/virt-homeworks/tree/master/additional/README.md).

## Задача 1

Архитектор ПО решил проконсультироваться у вас, какой тип БД 
лучше выбрать для хранения определенных данных.

Он вам предоставил следующие типы сущностей, которые нужно будет хранить в БД:

- Электронные чеки в json виде
- Склады и автомобильные дороги для логистической компании
- Генеалогические деревья
- Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации
- Отношения клиент-покупка для интернет-магазина

Выберите подходящие типы СУБД для каждой сущности и объясните свой выбор.

### Ответ

- **Электронные чеки в json виде** - документоориентированная NoSQL СУБД, например MongoDB;
- **Склады и автомобильные дороги для логистической компании** - графовая NoSQL СУБД, например GraphQL;
- **Генеалогические деревья** - сетевая (NoSQL) СУБД;
- **Кэш идентификаторов клиентов с ограниченным временем жизни для движка аутенфикации** - ключ-значение NoSQL СУБД, например redis;
- **Отношения клиент-покупка для интернет-магазина** - реляционная (SQL) СУБД.

## Задача 2

Вы создали распределенное высоконагруженное приложение и хотите классифицировать его согласно 
CAP-теореме. Какой классификации по CAP-теореме соответствует ваша система, если 
(каждый пункт - это отдельная реализация вашей системы и для каждого пункта надо привести классификацию):

- Данные записываются на все узлы с задержкой до часа (асинхронная запись)
- При сетевых сбоях, система может разделиться на 2 раздельных кластера
- Система может не прислать корректный ответ или сбросить соединение

А согласно PACELC-теореме, как бы вы классифицировали данные реализации?

### Ответ

согласно CAP-теореме:

- **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** - AP, нет согласованности (асинхронность);
- **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - AP, при разделении на 2 раздельных кластера нет согласованности, согласно PA/EC;
- **Система может не прислать корректный ответ или сбросить соединение** - PC, так как согласно условию система может не дать ответ, но не может дать некорректный ответ, значит система не может в **Availability**, при которой ответ был бы всегда. 

огласно PACELC-теореме:

- **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** - PA/EL, так как жертвуется скорость согласованности;
- **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - PA/EC, так как при аварии жертвуется согласованность.
- **Система может не прислать корректный ответ или сбросить соединение** - PC/EC, так как в жертву приносится доступность.

### Доработка / Объяснение

- **Данные записываются на все узлы с задержкой до часа (асинхронная запись)** - так как на все узлы системы данные записываются с существенной задержкой до часа (асинхронно), то в момент времени данные на разных узлах данные могут отличаться, значит о **Consistency** (Согласованность данных) не может быть и речи. Также это условие может косвенно говорить о том, что при разрыве соединения между частями узлов не скажется на доступности данных (хоть и не согласованных данных). Глядя на данное условие приходит в голову геораспределенная система с каналом связи между узлами с небольшой пропускной способностью, а синхронизация данных происходит по принципу реплицирования данных. Так как условие явно не задает устойчива ли система к разделению и доступны ли данные до момента синхронизации, будем считать что система обладает данными свойствами. Таким образом согласно **CAP-теореме** это **AP** система, в которой данные всегда доступны (Availability) и система устойчива к разделению (Partition tolerance), и согласно PACELC-теореме: **PA/EL** т.е. при разделении (Partition) сохраняется высока доступность (Availability), когда система работает нормально (Else) минимизируется задержка (Latency).

- **При сетевых сбоях, система может разделиться на 2 раздельных кластера** - Так как по условию система при сбоях может разделяется на 2 раздельных кластера (Partition), то данные всеравно остаются доступными (Availability), но согласованности данных(Consistency) в такой системе при разделении не может быть по определению, поэтому согласно CAP-теореме: **AP**, а согласно PACELC-теореме: **PA/EC**, т.е. при разделении (Partition) сохраняется высока доступность (Availability), когда система работает нормально (Else) обеспечивается согласованность данных (Consistency).

- **Система может не прислать корректный ответ или сбросить соединение** - так как по условию, система "может **не** прислать **корректный** ответ или (может) **сбросить соединение**", а про возможность системы отправить **некорректный ответ** в условии ничего не сказано, допустим, что система **не может** прислать **некорректный ответ**. Таким образом система либо не отвечает (не присылает корректный ответ) или сбрасывает соединение, значит данные не всегда доступны (Availability). Значит система согласно CAP-теореме либо **CA** (предположим что не может быть отдан ответ или сброшено соединение при делении системы), либо **PC** (система при разделении не отвечает/сбрасывает соединение пока данные не синхронизируются между разделенными кластерами системы). А PACELC-теореме: **PC/EC** при разделении система не дает ответ до момента синхронизации данных (Partition и Consistency) ,а в случае нормальной работы (Else) сохраняется согласованность (Consistency) так как по условию система либо не дает никакого ответа либо сбрасывает соединение, значит некорректных данных в ответе быть не может. Если предположить что имелось ввиду, что система может прислать **некорректный** ответ, тогда получается что система может как прислать корректный ответ, так и некорректный, а еще сбросить соединение. Значит отсутствуют 2 из 3 параметров по CAP, первый из которой **Consistency** (неверный ответ), а второй либо **Availability** (система может разделяться, но при разделении может сбросить соединение), либо **Partition** (система не может разделяться, и при разделении будет сброшено соединение). В случае такой интерпретации условия согласно PACELC-теореме: **PC/EC** т.е. система жертвует доступностью при разделении или **PA/EC** система жертвует синхронность при нормальной работе.


## Задача 3

Могут ли в одной системе сочетаться принципы BASE и ACID? Почему?

### Ответ

Нет, так как это противоположные принципы построения (BASE - производительность важнее доступности, ACID согласованность важнее доступности).

## Задача 4

Вам дали задачу написать системное решение, основой которого бы послужили:

- фиксация некоторых значений с временем жизни
- реакция на истечение таймаута

Вы слышали о key-value хранилище, которое имеет механизм [Pub/Sub](https://habr.com/ru/post/278237/). 
Что это за система? Какие минусы выбора данной системы?

### Ответ

Redis.

Плюсы:

- Высокая производительность (скорость обработки запросов);
- Не требует места на диске, все в RAM (кроме некоторых случаев);
- Поддерживает репликацию (с перенаправлением запросов);
- Создание резервных копий (снапшотов) на диске;
- Открытое ПО.

Минусы:

- При отсутствии репликации и резервного копирования (снапшотов) риск потерять данные;
- Может занимать большой объем RAM;

---

### Как cдавать задание

Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

---